#+TITLE: Monitoring Data Entry for Haryana Surveys
#+AUTHOR: SSER
#+OPTIONS: H:3 ^:{}
#+LATEX_HEADER: \usepackage{booktabs}
#+LATEX_HEADER: \usepackage{tabularx}
#+TODO: TODO EDIT CHECK | DONE
#+PROPERTY: header-args:R :session haryana :eval never-export

* Preliminaries                                                    :noexport:

#+NAME: load-libraries
#+BEGIN_SRC R :results silent :exports none

require(RPostgreSQL)
require(ggplot2)
require(data.table)

#+END_SRC


#+NAME: read-data-code
#+BEGIN_SRC R :results silent :exports none
  drv <- dbDriver("PostgreSQL")

  surveypg <- dbConnect(drv, dbname = "ssersurveydata",
                   host = "localhost", port = 5432,
                   user = "ssersurveyuser")

  data.table(dbReadTable(surveypg,"ruralsurvey_household"))->household
  data.table(dbReadTable(surveypg,"ruralsurvey_member"))->member
  data.table(dbReadTable(surveypg,"ruralsurvey_codecaste"))->castes
  data.table(dbReadTable(surveypg,"ruralsurvey_codevillage"))->villages
#+END_SRC

* Overall Decisions

This section records any overall decisions that are taken.

**** TODO Decide on how to deal with ranges
**** TODO Fix social group for each caste
+ Each caste belongs to a unique social group. This needs to be correctly identified and informed to all data operators.
**** TODO Sample weights
+ Vikas needs to check the sampling scripts and get the sampling weights.
**** DONE Standard values of assets                                :Vikas:
CLOSED: [2018-11-11 Sun 05:56]
***** Compute unit price from available data, and provide a table of summary statistics for each type of asset

* Database corrections                                                :Vikas:
***** TODO FIES filter on names
***** TODO Comments on FIES questions
***** TODO Crops filter
***** DONE CodePlaces
***** DONE Make a block/page-wise table of data operators
CLOSED: [2018-11-11 Sun 06:59]

* Inconsistencies in Data                                       :Sonia:Jesim:
** Households for which data are missing for critical variables

This section lists data gaps that are critical. Sonia to attend to these, in consultation with Jesim, where required.

#+NAME: missing-data-code
#+BEGIN_SRC R :results value :exports results :colnames yes :hline yes
  merge(household,villages,by.x="village_id",by.y="id")->t
  merge(t,castes,by.x="caste_tribe_id",by.y="id")->t
  t[is.na(if_sc_st),.(village_name,household_number,blankfield="if_sc_st",detail=caste_tribe)][order(village_name,household_number)]
#+END_SRC

#+NAME: missing-data-code
#+CAPTION: Households with data missing for critical variables
#+RESULTS: missing-data-code
| village_name     | household_number | blankfield | detail   |
|------------------+------------------+------------+----------|
| Birdhana         |                7 | if_sc_st   | Rebari   |
| Birdhana         |               19 | if_sc_st   | Dhanak   |
| Birdhana         |               25 | if_sc_st   | Jat      |
| Birdhana         |               35 | if_sc_st   | Kamboj   |
| Birdhana         |               36 | if_sc_st   | Kamboj   |
| Birdhana         |               40 | if_sc_st   | Dhanak   |
| Birdhana         |               46 | if_sc_st   | Rebari   |
| Birdhana         |               61 | if_sc_st   | Rai Sikh |
| Birdhana         |               62 | if_sc_st   | Od       |
| Birdhana         |               63 | if_sc_st   | Jat      |
| Birdhana         |               65 | if_sc_st   | Jat      |
| Birdhana         |               67 | if_sc_st   | Bishnoi  |
| Birdhana         |               68 | if_sc_st   | Mali     |
| Birdhana         |               69 | if_sc_st   | Arora    |
| Birdhana         |               70 | if_sc_st   | Bishnoi  |
| Birdhana         |               71 | if_sc_st   | Arora    |
| Birdhana         |               73 | if_sc_st   | Teli     |
| Birdhana         |              103 | if_sc_st   | Bishnoi  |
| Birdhana         |              104 | if_sc_st   | Mehta    |
| Birdhana         |              105 | if_sc_st   | Bishnoi  |
| Cheher Kalan     |                4 | if_sc_st   | Brahmin  |
| Cheher Kalan     |                9 | if_sc_st   | Dhanak   |
| Cheher Kalan     |               10 | if_sc_st   | Baniya   |
| Cheher Kalan     |               12 | if_sc_st   | Chamar   |
| Cheher Kalan     |               13 | if_sc_st   | Jat      |
| Cheher Kalan     |               14 | if_sc_st   | Dhanak   |
| Cheher Kalan     |               15 | if_sc_st   | Nai      |
| Cheher Kalan     |               24 | if_sc_st   | Sunar    |
| Cheher Kalan     |               27 | if_sc_st   | Chamar   |
| Cheher Kalan     |               29 | if_sc_st   | Jat      |
| Cheher Kalan     |               32 | if_sc_st   | Jat      |
| Cheher Kalan     |               33 | if_sc_st   | Chamar   |
| Cheher Kalan     |               34 | if_sc_st   | Jat      |
| Cheher Kalan     |               36 | if_sc_st   | Brahmin  |
| Cheher Kalan     |               44 | if_sc_st   | Jat      |
| Cheher Kalan     |               48 | if_sc_st   | Jat      |
| Cheher Kalan     |               51 | if_sc_st   | Khati    |
| Cheher Kalan     |               52 | if_sc_st   | Nai      |
| Cheher Kalan     |               53 | if_sc_st   | Jat      |
| Cheher Kalan     |              101 | if_sc_st   | Brahmin  |
| Jamalpur Shekhan |                1 | if_sc_st   | Od       |
| Jamalpur Shekhan |                2 | if_sc_st   | Od       |
| Jamalpur Shekhan |                6 | if_sc_st   | Saini    |
| Jamalpur Shekhan |               14 | if_sc_st   | Kamboj   |
| Jamalpur Shekhan |               16 | if_sc_st   | Jat      |
| Jamalpur Shekhan |               27 | if_sc_st   | Chamar   |
| Jamalpur Shekhan |               28 | if_sc_st   | Chamar   |
| Jamalpur Shekhan |               31 | if_sc_st   | Jat      |
| Jamalpur Shekhan |               32 | if_sc_st   | Arora    |
| Jamalpur Shekhan |               36 | if_sc_st   | Jat      |
| Jamalpur Shekhan |               37 | if_sc_st   | Arora    |
| Jamalpur Shekhan |               39 | if_sc_st   | Balmiki  |
| Jamalpur Shekhan |               41 | if_sc_st   | Bazigar  |
| Jamalpur Shekhan |               44 | if_sc_st   | Saini    |
| Jamalpur Shekhan |               46 | if_sc_st   | Garg     |
| Jamalpur Shekhan |               48 | if_sc_st   | Jat      |
| Jamalpur Shekhan |               50 | if_sc_st   | Saini    |
| Jamalpur Shekhan |               55 | if_sc_st   | Bawaria  |
| Jamalpur Shekhan |               59 | if_sc_st   | Od       |
| Khandrai         |              102 | if_sc_st   | Kumhar   |

** Data categorisation issues
**** TODO Majhabi Sikh and Rai Sikh are perhaps same
**** TODO Jhimar and Dhinvar are same
**** TODO Lohar categorised as both BC and SC

** Abnormal asset prices

#+NAME: asset_outlier_code
#+BEGIN_SRC R :results value :exports results :colnames yes :hline yes

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_other")->t0
  dbReadTable(surveypg,"ruralsurvey_code_asset_others")->code
  merge(t0,code,by.x="asset_id",by.y="id")->t0

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_transport")->t1
  dbReadTable(surveypg,"ruralsurvey_code_asset_transport")->code
  merge(t1,code,by.x="asset_id",by.y="id")->t1

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_electrical")->t2
  dbReadTable(surveypg,"ruralsurvey_code_asset_electrical")->code
  merge(t2,code,by.x="asset_id",by.y="id")->t2

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_furniture")->t3
  dbReadTable(surveypg,"ruralsurvey_code_asset_furniture")->code
  merge(t3,code,by.x="asset_id",by.y="id")->t3


  dbReadTable(surveypg,"ruralsurvey_asset_ownership_inventories")->t4
  dbReadTable(surveypg,"ruralsurvey_code_asset_inventories")->code
  merge(t4,code,by.x="asset_id",by.y="id")->t4

  data.table(rbind(t0,t1,t2,t3))->t
  merge(household,villages,by.x="village_id",by.y="id")->h
  merge(t,h,by.x="sno_id",by.y="id")->t
  t$value/t$no->t$price
  t[!is.na(price)]->t
  t[asset=="Scooter/motorcycle"][price>100000][,.(village_name,household_number,asset,price)]->t1
  rbind(t1,t[asset=="Refrigerator"][price>10000][,.(village_name,household_number,asset,price)])->t1
  rbind(t1,t[asset=="Almirah/cupboard"][price>10000][,.(village_name,household_number,asset,price)])->t1
  rbind(t1,t[asset=="Tape recorder/Two-in-one"][price>5000][,.(village_name,household_number,asset,price)])->t1
  t1
#+END_SRC

#+name: asset_outlier
#+CAPTION: Abnormal values of asset prices
#+RESULTS: asset_outlier_code
| village_name     | household_number | asset                    |   price |
|------------------+------------------+--------------------------+---------|
| Khandrai         |               27 | Scooter/motorcycle       | 1500000 |
| Cheher Kalan     |               50 | Scooter/motorcycle       |  125000 |
| Cheher Kalan     |               50 | Scooter/motorcycle       |  125000 |
| Cheher Kalan     |               50 | Scooter/motorcycle       |  125000 |
| Cheher Kalan     |               22 | Refrigerator             |   20000 |
| Khandrai         |                1 | Refrigerator             |   25000 |
| Jamalpur Shekhan |                9 | Almirah/cupboard         |   35000 |
| Khandrai         |                5 | Tape recorder/Two-in-one |   45000 |

* Emerging patterns

This section will provide a compilation of tables and graphs on different aspects of social and economic conditions in the village.

** Caste Composition

#+NAME: caste-composition-code
#+BEGIN_SRC R :results value :exports results :colnames yes :hline yes
merge(household,villages,by.x="village_id",by.y="id")->t
  merge(t,castes,by.x="caste_tribe_id",by.y="id")->t
  t[,.(Number=length(household_number)),keyby=.(village_name,if_sc_st,caste_tribe)][CJ(unique(village_name),unique(if_sc_st),unique(caste_tribe))][,as.list(Number),by=.(if_sc_st,caste_tribe)]->t1
  t1[!(is.na(V1)&is.na(V3)&is.na(V3)&is.na(V4))]->t1
  names(t1)[c(3:6)]<-villages$village_name
  names(t1)[c(1:2)]<-c("Social group","Caste")
  t1
#+END_SRC

#+NAME: caste-composition-code
#+CAPTION: Caste representation in the sample
#+RESULTS: caste-composition-code
| Social group | Caste        | Khandrai | Cheher Kalan | Jamalpur Shekhan | Birdhana |
|--------------+--------------+----------+--------------+------------------+----------|
| nil          | Arora        |        2 | nil          | 2                | nil      |
| nil          | Balmiki      |      nil | nil          | 1                | nil      |
| nil          | Bawaria      |      nil | nil          | 1                | nil      |
| nil          | Bazigar      |      nil | nil          | 1                | nil      |
| nil          | Bishnoi      |        4 | nil          | nil              | nil      |
| nil          | Chamar       |      nil | 3            | 2                | nil      |
| nil          | Dhanak       |        2 | 2            | nil              | nil      |
| nil          | Garg         |      nil | nil          | 1                | nil      |
| nil          | Jat          |        3 | 7            | 4                | nil      |
| nil          | Kamboj       |        2 | nil          | 1                | nil      |
| nil          | Kumhar       |      nil | nil          | nil              | 1        |
| nil          | Mali         |        1 | nil          | nil              | nil      |
| nil          | Mehta        |        1 | nil          | nil              | nil      |
| nil          | Od           |        1 | nil          | 3                | nil      |
| nil          | Rai Sikh     |        1 | nil          | nil              | nil      |
| nil          | Rebari       |        2 | nil          | nil              | nil      |
| nil          | Saini        |      nil | nil          | 3                | nil      |
| nil          | Teli         |        1 | nil          | nil              | nil      |
| BC           | Bhatra sikh  |      nil | nil          | 1                | nil      |
| BC           | Dhinwar      |        1 | nil          | nil              | nil      |
| BC           | Jhimar       |      nil | nil          | nil              | 3        |
| BC           | Jogi         |      nil | nil          | nil              | 1        |
| BC           | Kamboj       |        3 | nil          | 2                | nil      |
| BC           | Khati        |      nil | 8            | nil              | 2        |
| BC           | Kumhar       |        1 | 2            | nil              | 4        |
| BC           | Lohar        |        1 | nil          | 1                | nil      |
| BC           | Nai          |        2 | 3            | 2                | nil      |
| BC           | Rebari       |        6 | nil          | nil              | nil      |
| BC           | Saini        |      nil | nil          | 8                | nil      |
| BC           | Yadav        |      nil | nil          | nil              | 1        |
| Other        | Arora        |        1 | nil          | nil              | nil      |
| Other        | Baniya       |        1 | 2            | nil              | nil      |
| Other        | Bishnoi      |        5 | nil          | nil              | nil      |
| Other        | Brahmin      |      nil | 3            | nil              | 1        |
| Other        | Jat          |        6 | 3            | 4                | 23       |
| Other        | Khati        |      nil | nil          | 3                | nil      |
| Other        | Mehta        |        5 | nil          | nil              | nil      |
| Other        | Sunar        |        1 | nil          | nil              | nil      |
| SC           | Balmiki      |      nil | nil          | 4                | 1        |
| SC           | Bawaria      |      nil | nil          | nil              | 1        |
| SC           | Bazigar      |        2 | nil          | 4                | nil      |
| SC           | Chamar       |        9 | 4            | 6                | 17       |
| SC           | Dhanak       |        5 | 6            | nil              | 17       |
| SC           | Lohar        |        1 | 1            | nil              | nil      |
| SC           | Mazhabi Sikh |        1 | nil          | nil              | nil      |
| SC           | Nayak        |        1 | nil          | nil              | nil      |
| SC           | Od           |        1 | nil          | 5                | nil      |
| SC           | Rai Sikh     |       12 | nil          | nil              | nil      |
| SC           | Rebari       |        1 | nil          | nil              | nil      |

** Land relations
** Food security
** Cropping pattern, Production, Input use
** Labour Deployment
** Employment
** Livestock
** Housing and Sanitation
** Health and Education
** Assets and Indebtedness

#+NAME: asset_unit_values_code
#+BEGIN_SRC R :results value :exports results :colnames yes :hline yes

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_other")->t0
  dbReadTable(surveypg,"ruralsurvey_code_asset_others")->code
  merge(t0,code,by.x="asset_id",by.y="id")->t0

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_transport")->t1
  dbReadTable(surveypg,"ruralsurvey_code_asset_transport")->code
  merge(t1,code,by.x="asset_id",by.y="id")->t1

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_electrical")->t2
  dbReadTable(surveypg,"ruralsurvey_code_asset_electrical")->code
  merge(t2,code,by.x="asset_id",by.y="id")->t2

  dbReadTable(surveypg,"ruralsurvey_asset_ownership_furniture")->t3
  dbReadTable(surveypg,"ruralsurvey_code_asset_furniture")->code
  merge(t3,code,by.x="asset_id",by.y="id")->t3


  dbReadTable(surveypg,"ruralsurvey_asset_ownership_inventories")->t4
  dbReadTable(surveypg,"ruralsurvey_code_asset_inventories")->code
  merge(t4,code,by.x="asset_id",by.y="id")->t4

  data.table(rbind(t0,t1,t2,t3))->t
  round(t$value/t$no)->t$price
  t[!is.na(price)]->t
  t[,as.list(summary(price)),keyby=asset]->t1
  t1[,Mean:=round(Mean)]->t1
  t[,.N,keyby=asset]->t2
  merge(t1,t2,by="asset")
#+END_SRC

#+NAME: asset_unit_values
#+CAPTION: Summary statistics for unit prices of assets
#+RESULTS: asset_unit_values_code
| asset                      |  Min. | 1st Qu. | Median |   Mean | 3rd Qu. |    Max. |  N |
|----------------------------+-------+---------+--------+--------+---------+---------+----|
| Air-conditioner            |   500 |    6625 |  12750 |  12750 |   18875 |   25000 |  2 |
| Almirah/cupboard           |  4000 |   11750 |  19500 |  19500 |   27250 |   35000 |  2 |
| Auto Rickshaw              | 30000 |   30000 |  30000 |  30000 |   30000 |   30000 |  1 |
| Bicycle                    |   200 |     600 |   1200 |   1989 |    1500 |   10000 |  9 |
| Cable connection           |   150 |     150 |    150 |    583 |   412.5 |    2400 |  6 |
| Car/Jeep                   | 40000 |  150000 |  2e+05 | 203846 |  275000 |   4e+05 | 13 |
| Ceiling fan                |   600 |   612.5 |    625 |   2075 |  2812.5 |    5000 |  3 |
| Chair/stool/bench          |   300 |     300 |    300 |    300 |     300 |     300 |  1 |
| Clock                      |   150 |     150 |    150 |    150 |     150 |     150 |  1 |
| Colour TV                  |  2000 |    2250 |   5000 |   8357 |    6000 |   35000 |  7 |
| Computer                   | 10000 |   12500 |  15000 |  15000 |   17500 |   20000 |  3 |
| Cooking gas+gas stove      |   500 |    1250 |   1500 |   1625 |    1875 |    3000 |  4 |
| Cooler                     |   750 |    2250 |   3000 |   3536 |    4250 |    8000 |  7 |
| Cot/Charpai                |   400 |     475 |    550 |    844 |  918.75 |    1875 |  4 |
| DVD/VCD/CD player          |  3000 |    3000 |   3000 |   3000 |    3000 |    3000 |  1 |
| Dish antenna               |  1500 |    1500 |   1500 |   1500 |    1500 |    1500 |  1 |
| Dressing table             |  4000 |    4000 |   4000 |   4000 |    4000 |    4000 |  1 |
| Generator                  | 10000 |   15000 |  20000 |  24000 |   25000 |   50000 |  5 |
| Inverter                   |    10 |  3756.5 |   8000 |   7218 |   10500 |   14000 |  7 |
| Iron                       |   250 |     250 |    250 |    250 |     250 |     250 |  1 |
| Lorry                      | 8e+05 |   8e+05 |  8e+05 |  8e+05 |   8e+05 |   8e+05 |  1 |
| Mixer/grinder/Milk-churner |  1500 |    1750 |   2000 |   2000 |    2250 |    2500 |  2 |
| Mobile phone               |   750 |   937.5 |   1500 |   1438 |    2000 |    2000 |  4 |
| Moped                      | 43000 |   43000 |  43000 |  43000 |   43000 |   43000 |  1 |
| Refrigerator               |  2000 |    3000 |   5000 |   8611 |    8000 |   25000 |  9 |
| Scooter/motorcycle         |  2500 |   11000 |  20000 |  62946 | 34166.5 | 1500000 | 43 |
| Sewing machine             |   800 |    1000 |   1000 |   1775 |    2550 |    4000 |  8 |
| Sofa set                   |  1333 | 2999.75 | 4666.5 |   4666 | 6333.25 |    8000 |  2 |
| Table                      |   500 |     500 |    500 |    667 |     750 |    1000 |  3 |
| Table fan                  |   800 |     825 |    850 |    850 |     875 |     900 |  2 |
| Tape recorder/Two-in-one   | 45000 |   45000 |  45000 |  45000 |   45000 |   45000 |  1 |
| Transistor/radio           |   500 |     500 |    500 |    500 |     500 |     500 |  1 |
| Trunk/box/suitcase         |   250 |     625 |    875 |   1500 |    1750 |    4000 |  4 |
| Washing machine            |  2000 |    4000 |   5000 |   4571 |    5000 |    7000 |  7 |
